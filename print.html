<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Nimi</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="Tini-like PID 1 for containers and target for NixOS modular services">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "ayu";
            window.path_to_searchindex_js = "searchindex-7af21c92.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-d80f7869.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Nimi</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/weyl-ai/nimi" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="nimi"><a class="header" href="#nimi"><code>Nimi</code></a></h1>
<p><code>Nimi</code> is a tiny process manager built for running NixOS modular services in containers and other minimal environments. It turns a NixOS modular services configuration into a reliable, lightweight runtime that starts services, streams logs, and applies predictable restart and startup behavior.</p>
<h1 id="why-nimi"><a class="header" href="#why-nimi">Why <code>Nimi</code></a></h1>
<p>Modular services are composable Nix modules: you can import a service, override options, and instantiate it multiple times with different settings. <code>Nimi</code> is the runtime that brings those modules to life outside a full init system (i.e. <code>systemd</code>).</p>
<p>If you are new to modular services, the upstream explanation is the best place to start: <a href="https://nixos.org/manual/nixos/unstable/#modular-services">NixOS Modular Services Manual</a>.</p>
<h1 id="whats-in-the-box"><a class="header" href="#whats-in-the-box">What’s in the box</a></h1>
<ul>
<li>A small PID 1 style runtime suitable for containers.</li>
<li>Clean process execution with structured startup and shutdown flow.</li>
<li>Configurable restart behavior for resilient services.</li>
<li>One-time startup hook for quick initialization steps.</li>
<li>Clear, instance-per-service configuration using modular services.</li>
</ul>
<h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<ol>
<li>Define services using modular service modules.</li>
<li>Evaluate the config with <code>nimi.mkNimiBin</code> to produce JSON.</li>
<li>Run <code>Nimi</code> with the generated config to launch and supervise services.</li>
</ol>
<h1 id="quick-start"><a class="header" href="#quick-start">Quick-start</a></h1>
<p>Minimal Nix configuration:</p>
<pre><code class="language-nix">packages.${system}.myNimiWrapper = pkgs.nimi.mkNimiBin {
  services."my-service" = {
    imports = [ pkgs.some-application.services.default ];
    someApplication = {
      listen = "0.0.0.0:8080";
      dataDir = "/var/lib/my-service";
    };
  };
  settings.restart.mode = "up-to-count";
  settings.restart.time = 2000;
}
</code></pre>
<p>Run the generated config:</p>
<pre><code class="language-bash">nix run .#myNimiWrapper
</code></pre>
<h1 id="configuration-highlights"><a class="header" href="#configuration-highlights">Configuration highlights</a></h1>
<ul>
<li><code>services</code>: declare named service instances by importing modular service
modules and overriding options per instance.</li>
<li><code>settings.restart</code>: choose <code>never</code>, <code>up-to-count</code>, or <code>always</code>, and tune delay
and retry count.</li>
<li><code>settings.startup</code>: optionally run one binary before services start.</li>
<li><code>settings.logging</code>: write per-service log files; see <code>docs/logging.md</code>.</li>
<li><code>configData</code>: define per-service config files; see <code>docs/config-data.md</code>.</li>
</ul>
<h1 id="next-steps"><a class="header" href="#next-steps">Next steps</a></h1>
<ul>
<li>Explore service definitions and compose them per environment.</li>
<li>Use restart policies to match reliability needs.</li>
<li>Add a startup hook for migrations, warm-ups, or one-time init tasks.</li>
<li>Create containers with <code>docs/container.md</code>.</li>
<li>Add <code>pkgs.nimi</code> to an existing <code>nixpkgs</code> instance with <code>docs/overlay.md</code>.</li>
<li>Integrate with Nix tooling: <code>docs/flake-module.md</code>, <code>docs/nixos-module.md</code>, and <code>docs/home-module.md</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="command-line-interface"><a class="header" href="#command-line-interface">Command Line Interface</a></h1>
<p>The <code>Nimi</code> CLI is the runtime entry-point for a generated modular services config. It validates the config, runs startup hooks, launches services, and streams their logs until shutdown.</p>
<h1 id="intended-use"><a class="header" href="#intended-use">Intended use</a></h1>
<p><code>Nimi</code> is meant to be the final step after evaluating a modular services configuration with <code>nimi.mkNimiBin</code>. It is lightweight enough for containers, but still gives you consistent startup, restart, and shutdown behavior.</p>
<h1 id="basic-flow"><a class="header" href="#basic-flow">Basic flow</a></h1>
<ol>
<li>Generate a JSON config using <code>nimi.mkNimiBin</code>.</li>
<li>Run <code>nimi --config ./my-config.json validate</code> to check it.</li>
<li>Run <code>nimi --config ./my-config.json run</code> to launch services.</li>
</ol>
<h1 id="commands"><a class="header" href="#commands">Commands</a></h1>
<ul>
<li><code>validate</code>: read and deserialize the config to ensure it is well-formed.</li>
<li><code>run</code>: start the process manager and run all configured services.</li>
</ul>
<h1 id="flags"><a class="header" href="#flags">Flags</a></h1>
<ul>
<li><code>--config</code>, <code>-c</code>: path to the generated JSON configuration file.</li>
</ul>
<h1 id="runtime-behavior"><a class="header" href="#runtime-behavior">Runtime behavior</a></h1>
<ul>
<li>Optional startup binary runs once before services start.</li>
<li>Each service runs its configured <code>argv</code>.</li>
<li>Service logs stream to stdout/stderr with the service name as the log target.</li>
<li>Restart behavior follows <code>settings.restart</code> (<code>never</code>, <code>up-to-count</code>, <code>always</code>).</li>
<li><code>Ctrl-C</code> triggers a graceful shutdown and waits for services to exit.</li>
</ul>
<h1 id="example"><a class="header" href="#example">Example</a></h1>
<pre><code class="language-bash">nimi --config ./result/nimi-config.json validate
nimi --config ./result/nimi-config.json run
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="config-data-files"><a class="header" href="#config-data-files">Config Data Files</a></h1>
<p><code>configData</code> lets modular service modules supply config files to a service
instance. <code>Nimi</code> treats the entries in the generated JSON as the final, resolved
files to expose.</p>
<p>At runtime, for each service:</p>
<ul>
<li><code>Nimi</code> serializes the service’s <code>configData</code> entries, hashes them, and creates a
temp directory (usually under <code>/tmp</code>) named <code>nimi-config-&lt;sha256&gt;</code>.</li>
<li>Each <code>configData.&lt;name&gt;.source</code> is symlinked into that directory at the
relative <code>configData.&lt;name&gt;.path</code> location.</li>
<li>The service is started with <code>XDG_CONFIG_HOME</code> set to the temp directory, so it
can read config files at <code>$XDG_CONFIG_HOME/&lt;path&gt;</code>.</li>
</ul>
<p><code>Nimi</code> does not render <code>configData.&lt;name&gt;.text</code> itself; the Nix evaluation/build
step generates the <code>source</code> files and the JSON points at them. Hence, updating the content
requires rebuilding the config and restarting <code>Nimi</code>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="logging"><a class="header" href="#logging">Logging</a></h1>
<p><code>Nimi</code> streams service logs to <code>stdout</code>/<code>stderr</code> and can also write per-service log
files when <code>settings.logging.enable</code> is set.</p>
<h1 id="file-layout"><a class="header" href="#file-layout">File layout</a></h1>
<p>When logging is enabled, <code>Nimi</code> creates a run-specific directory under
<code>settings.logging.logsDir</code> and writes one file per service:</p>
<ul>
<li><code>logs-{n}/service-a.txt</code></li>
<li><code>logs-{n}/service-b.txt</code></li>
</ul>
<blockquote>
<p>Where <code>n</code> is the successive iteration ran using the same logging directory</p>
</blockquote>
<p>Each file receives line-oriented output from the service. Both <code>stdout</code> and
<code>stderr</code> are appended to the same file, so the contents reflect the combined
stream.</p>
<h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<pre><code class="language-nix">settings.logging = {
  enable = true;
  logsDir = "my_logs";
};
</code></pre>
<h1 id="notes"><a class="header" href="#notes">Notes</a></h1>
<ul>
<li>Log files are created at runtime; they do not exist in the Nix store.</li>
<li>Disabling logging still streams logs to stdout/stderr, but no files are
created.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="containers"><a class="header" href="#containers">Containers</a></h1>
<p><code>Nimi</code> ships with a built-in container generator wired through <code>mkContainerImage</code>,
exposed via the package passthru (for example <code>pkgs.nimi.mkContainerImage</code> or
<code>self'.packages.nimi.mkContainerImage</code> in a flake).
It evaluates the same modular services config as <code>mkNimiBin</code>, then builds an OCI
image via <code>nix2container.buildImage</code> with the <code>Nimi</code> runner set as the <code>entrypoint</code>.</p>
<h1 id="minimal-example"><a class="header" href="#minimal-example">Minimal example</a></h1>
<pre><code class="language-nix">pkgs.nimi.mkContainerImage {
  services."my-app" = {
    imports = [ pkgs.some-application.services.default ];
    someApplication.listen = "0.0.0.0:8080";
  };
  settings.restart.mode = "up-to-count";
};
</code></pre>
<p>Build the image:</p>
<pre><code class="language-bash">nix build .#my-container
</code></pre>
<h1 id="image-settings"><a class="header" href="#image-settings">Image settings</a></h1>
<p>Use <code>settings.container</code> to control the image build. These options map directly
to <code>nix2container.buildImage</code>, so you can pass things like a base image or extra
files.</p>
<pre><code class="language-nix">settings.container = {
  name = "my-app";
  tag = "v1";
  fromImage = inputs.nix2container.packages.${system}.nix2container.pullImage {
    imageName = "alpine";
    imageDigest = "sha256:...";
    finalImageName = "alpine";
    finalImageTag = "3.20";
  };
  copyToRoot = [
    (pkgs.buildEnv {
      name = "runtime-bins";
      paths = [ pkgs.coreutils pkgs.bash ];
      pathsToLink = [ "/bin" ];
    })
  ];
};
</code></pre>
<h1 id="notes-1"><a class="header" href="#notes-1">Notes</a></h1>
<ul>
<li>The <code>entrypoint</code> is always the generated <code>Nimi</code> runner from <code>mkNimiBin</code>.</li>
<li><code>settings.container</code> only has an effect when building with <code>mkContainerImage</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sandbox"><a class="header" href="#sandbox">Sandbox</a></h1>
<p><code>Nimi</code> provides a lightweight sandbox runner via <code>mkBwrap</code>. It uses
<a href="https://github.com/containers/bubblewrap">bubblewrap</a> to run your services in
an isolated environment without requiring container runtimes like Docker or
Podman.</p>
<h2 id="what-it-provides"><a class="header" href="#what-it-provides">What it provides</a></h2>
<ul>
<li><strong>Isolated filesystem</strong>: A tmpfs-based root with selective host paths bound read-only.</li>
<li><strong>Environment variables</strong>: Set via <code>settings.bubblewrap.environment</code>.</li>
<li><strong>Working directory</strong>: Set via <code>settings.bubblewrap.chdir</code>.</li>
<li><strong>Namespace isolation</strong>: Separate user, PID, UTS, IPC, and cgroup namespaces by default.</li>
<li><strong>Writable directories</strong>: <code>/tmp</code>, <code>/run</code>, <code>/var</code>, <code>/etc</code> are tmpfs mounts for runtime writes.</li>
<li><strong>Nix store access</strong>: <code>/nix/store</code> is bind-mounted read-only so binaries can access their dependencies.</li>
</ul>
<h2 id="minimal-example-1"><a class="header" href="#minimal-example-1">Minimal example</a></h2>
<pre><code class="language-nix">pkgs.nimi.mkBwrap {
  services."my-app" = {
    process.argv = [ (lib.getExe pkgs.my-app) ];
  };
  settings.bubblewrap = {
    environment.MY_VAR = "value";
    chdir = "/app";
    extraTmpfs = [ "/data" ];
  };
}
</code></pre>
<p>Run the sandbox:</p>
<pre><code class="language-bash">nix run .#my-sandbox
</code></pre>
<h2 id="extended-example"><a class="header" href="#extended-example">Extended example</a></h2>
<pre><code class="language-nix">pkgs.nimi.mkBwrap {
  services."web-server" = {
    process.argv = [ (lib.getExe pkgs.nginx) "-g" "daemon off;" ];
  };
  settings.bubblewrap = {
    environment = {
      APP_ENV = "production";
      LOG_LEVEL = "info";
    };
    chdir = "/srv";
    roBinds = [
      { src = "/nix/store"; dest = "/nix/store"; }
      { src = "/etc/ssl"; dest = "/etc/ssl"; }
      { src = "/run/secrets"; dest = "/secrets"; }
    ];
    extraTmpfs = [ "/var/cache/nginx" ];
  };
}
</code></pre>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How it works</a></h2>
<ol>
<li><strong>Build time</strong>: The nimi binary is wrapped in a shell script that invokes <code>bwrap</code>.</li>
<li><strong>Execution</strong>: <code>bwrap</code> runs the nimi binary inside an isolated namespace with:
<ul>
<li>Tmpfs mounts created first (providing writable areas)</li>
<li>Read-only bind mounts layered on top (e.g., <code>/nix/store</code> over <code>/nix</code>)</li>
<li><code>/dev</code> and <code>/proc</code> bound from the host</li>
<li>Environment variables and working directory applied</li>
<li>Namespaces unshared according to configuration</li>
</ul>
</li>
</ol>
<h2 id="differences-from-containers"><a class="header" href="#differences-from-containers">Differences from containers</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th><code>mkBwrap</code></th><th><code>mkContainerImage</code></th></tr>
</thead>
<tbody>
<tr><td>Runtime dependencies</td><td><code>bubblewrap</code> only</td><td>Container runtime (Docker, Podman)</td></tr>
<tr><td>Image format</td><td>None (uses Nix store directly)</td><td>OCI image</td></tr>
<tr><td>Startup time</td><td>Fast (no image loading)</td><td>Depends on runtime</td></tr>
<tr><td>Portability</td><td>Linux only</td><td>Any OCI-compatible runtime</td></tr>
<tr><td>Base images</td><td>Not supported</td><td>Supported via <code>fromImage</code></td></tr>
<tr><td>Root filesystem</td><td>Tmpfs with bind mounts</td><td>Layered image filesystem</td></tr>
</tbody>
</table>
</div>
<h2 id="notes-2"><a class="header" href="#notes-2">Notes</a></h2>
<ul>
<li>The sandbox requires Linux with user namespaces enabled.</li>
<li>Writes go to tmpfs directories; they are lost when the sandbox exits.</li>
<li>Signal handling (Ctrl+C) is supported.</li>
<li>The entrypoint is always the generated nimi runner from <code>mkNimiBin</code>.</li>
<li>Not available on macOS (<code>meta.badPlatforms</code> includes Darwin).</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="overlay"><a class="header" href="#overlay">Overlay</a></h1>
<p><code>Nimi</code> exposes an overlay as a standalone flake output. Use it when you want to
add <code>nimi</code> to an existing <code>nixpkgs</code> instance in order to make using the <code>passthru</code> attributes easier.</p>
<h2 id="example-1"><a class="header" href="#example-1">Example</a></h2>
<pre><code class="language-nix">{
  inputs.nimi.url = "github:weyl-ai/nimi";

  outputs = { self, nixpkgs, nimi, ... }:
    let
      system = "x86_64-linux";
      pkgs = import nixpkgs {
        inherit system;
        overlays = [ nimi.overlays.default ];
      };
    in
    {
      packages.${system}.default = pkgs.nimi;
    };
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="flake-module"><a class="header" href="#flake-module">Flake Module</a></h1>
<p>The flake module output (<code>nimi.flakeModule</code>) wires <code>Nimi</code> into a <code>flake-parts</code> setup.
It takes named service definitions and turns them into runnable <code>Nimi</code> binaries and
container images, so you can build local runners, CI checks, and deployable
artifacts from one source of truth.</p>
<h2 id="what-it-provides-1"><a class="header" href="#what-it-provides-1">What it provides</a></h2>
<p>For each <code>perSystem.nimi.&lt;name&gt;</code> entry, the module generates:</p>
<ul>
<li><code>packages.&lt;name&gt;-service</code>: a <code>Nimi</code> runtime binary built from the services module.</li>
<li><code>packages.&lt;name&gt;-container</code>: a container image bundling that runtime.</li>
<li><code>checks.&lt;name&gt;-service</code> and <code>checks.&lt;name&gt;-container</code>: the same outputs, wired into CI.</li>
</ul>
<h2 id="minimal-example-2"><a class="header" href="#minimal-example-2">Minimal example</a></h2>
<pre><code class="language-nix">{
  perSystem = { pkgs, ... }: {
    nimi."web" = {
      services."my-app" = {
        process.argv = [
          (lib.getExe pkgs.my-app)
          "--port"
          "8080"
        ];
      };
      settings.restart.mode = "up-to-count";
      settings.restart.time = 2000;
    };
  };
}
</code></pre>
<p>Build or run the outputs:</p>
<pre><code class="language-bash">nix build .#web-service
nix build .#web-container
</code></pre>
<h2 id="notes-3"><a class="header" href="#notes-3">Notes</a></h2>
<ul>
<li>The module is designed for <code>flake-parts</code> and expects <code>perSystem.nimi</code> entries.</li>
<li>Outputs are generated per system, so each target platform gets its own runner.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="nixos-module"><a class="header" href="#nixos-module"><code>NixOS</code> Module</a></h1>
<p>The <code>NixOS</code> module output (<code>nimi.nixosModules.default</code>) wires <code>Nimi</code> into a <code>NixOS</code>
configuration. It takes named service definitions and turns them into system
packages and <code>systemd</code> units, so you can run the same modular service config on
full <code>NixOS</code>.</p>
<h2 id="what-it-provides-2"><a class="header" href="#what-it-provides-2">What it provides</a></h2>
<p>For each <code>nimi.&lt;name&gt;</code> entry, the module generates:</p>
<ul>
<li><code>environment.systemPackages</code>: the <code>Nimi</code> runtime binary built from the services module.</li>
<li><code>systemd.services.&lt;name&gt;</code>: a system service that runs the generated binary.</li>
</ul>
<h2 id="minimal-example-3"><a class="header" href="#minimal-example-3">Minimal example</a></h2>
<pre><code class="language-nix">{
  imports = [
    inputs.nimi.nixosModules.default
  ];

  nimi."web" = {
    services."my-app" = {
      process.argv = [
        (lib.getExe pkgs.my-app)
        "--port"
        "8080"
      ];
    };
    settings.restart.mode = "up-to-count";
    settings.restart.time = 2000;
  };
}
</code></pre>
<h2 id="notes-4"><a class="header" href="#notes-4">Notes</a></h2>
<ul>
<li>Each <code>nimi.&lt;name&gt;</code> becomes a <code>systemd</code> unit named <code>&lt;name&gt;.service</code>.</li>
<li>The service is configured with a basic restart policy; override in <code>systemd.services</code> if needed.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="home-manager-module"><a class="header" href="#home-manager-module">Home Manager Module</a></h1>
<p>The Home Manager module output (<code>nimi.homeModules.default</code>) wires <code>Nimi</code> into a
Home Manager configuration. It takes named service definitions and turns them
into user packages and <code>systemd</code> user units, so you can run the same modular
service config as per-user services.</p>
<h2 id="what-it-provides-3"><a class="header" href="#what-it-provides-3">What it provides</a></h2>
<p>For each <code>nimi.&lt;name&gt;</code> entry, the module generates:</p>
<ul>
<li><code>home.packages</code>: the <code>Nimi</code> runtime binary built from the services module.</li>
<li><code>systemd.user.services.&lt;name&gt;</code>: a user service that runs the generated binary.</li>
</ul>
<h2 id="minimal-example-4"><a class="header" href="#minimal-example-4">Minimal example</a></h2>
<pre><code class="language-nix">{
  imports = [
    inputs.nimi.homeModules.default
  ];

  nimi."web" = {
    services."my-app" = {
      process.argv = [
        (lib.getExe pkgs.my-app)
        "--port"
        "8080"
      ];
    };
    settings.restart.mode = "up-to-count";
    settings.restart.time = 2000;
  };
}
</code></pre>
<h2 id="notes-5"><a class="header" href="#notes-5">Notes</a></h2>
<ul>
<li>Each <code>nimi.&lt;name&gt;</code> becomes a <code>systemd --user</code> unit named <code>&lt;name&gt;.service</code>.</li>
<li>User services may require <code>loginctl enable-linger</code> if you need them running without an active session.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sec-functions-library-"><a class="header" href="#sec-functions-library-">Nimi library functions</a></h1>
<h2 id="niminimi.evalNimiModule"><a class="header" href="#niminimi.evalNimiModule"><code>nimi.evalNimiModule</code></a></h2>
<p>Evaluate a nimi module and return its config. This runs the module set
through <code>lib.evalModules</code> with the nimi module included so you get the
fully merged, validated configuration output.</p>
<h3 id="example-2"><a class="header" href="#example-2">Example</a></h3>
<pre><code class="language-nix">evalNimiModule {
  settings.binName = "my-nimi";
}
</code></pre>
<h3 id="type"><a class="header" href="#type">Type</a></h3>
<pre><code>evalNimiModule :: AttrSet -&gt; AttrSet
</code></pre>
<h3 id="arguments"><a class="header" href="#arguments">Arguments</a></h3>
<dl>
<dt id="module"><a class="header" href="#module">module</a></dt>
<dd>A nimi module attrset.</dd>
</dl>
<h2 id="niminimi.toNimiJson"><a class="header" href="#niminimi.toNimiJson"><code>nimi.toNimiJson</code></a></h2>
<p>Render an evaluated config to validated JSON. The config is serialized,
formatted with <code>jq</code>, then validated by running <code>nimi --config ... validate</code>
so the resulting file is both pretty-printed and schema-checked.</p>
<h3 id="example-1-1"><a class="header" href="#example-1-1">Example</a></h3>
<pre><code class="language-nix">let cfg = evalNimiModule { settings.binName = "my-nimi"; };
in toNimiJson cfg
</code></pre>
<h3 id="type-1"><a class="header" href="#type-1">Type</a></h3>
<pre><code>toNimiJson :: AttrSet -&gt; Path
</code></pre>
<h3 id="arguments-1"><a class="header" href="#arguments-1">Arguments</a></h3>
<dl>
<dt id="evaluatedconfig"><a class="header" href="#evaluatedconfig">evaluatedConfig</a></dt>
<dd>The evaluated nimi config.</dd>
</dl>
<h2 id="niminimi.mkNimiBinWithConfig"><a class="header" href="#niminimi.mkNimiBinWithConfig"><code>nimi.mkNimiBinWithConfig</code></a></h2>
<p>Build a wrapper binary from an already-evaluated nimi config. This writes
a validated JSON config and emits a shell wrapper that runs <code>nimi</code> with
that config so consumers can execute it like a normal binary.</p>
<p>Use this when you already have an evaluated config (e.g., from <code>evalNimiModule</code>)
and want to avoid re-evaluating the module.</p>
<h3 id="example-2-1"><a class="header" href="#example-2-1">Example</a></h3>
<pre><code class="language-nix">let cfg = evalNimiModule { settings.binName = "my-nimi"; };
in mkNimiBinWithConfig cfg
</code></pre>
<h3 id="type-2"><a class="header" href="#type-2">Type</a></h3>
<pre><code>mkNimiBinWithConfig :: AttrSet -&gt; Derivation
</code></pre>
<h3 id="arguments-2"><a class="header" href="#arguments-2">Arguments</a></h3>
<dl>
<dt id="evaluatedconfig-1"><a class="header" href="#evaluatedconfig-1">evaluatedConfig</a></dt>
<dd>An already-evaluated nimi config (output of <code>evalNimiModule</code>).</dd>
</dl>
<h2 id="niminimi.mkNimiBin"><a class="header" href="#niminimi.mkNimiBin"><code>nimi.mkNimiBin</code></a></h2>
<p>Build a wrapper binary for a given nimi module. This evaluates the module,
writes a validated JSON config, and emits a shell wrapper that runs <code>nimi</code>
with that config so consumers can execute it like a normal binary.</p>
<p>This is a convenience wrapper around <code>mkNimiBinWithConfig</code> that handles
module evaluation for you.</p>
<h3 id="example-3"><a class="header" href="#example-3">Example</a></h3>
<pre><code class="language-nix">mkNimiBin { settings.binName = "my-nimi"; }
</code></pre>
<h3 id="type-3"><a class="header" href="#type-3">Type</a></h3>
<pre><code>mkNimiBin :: AttrSet -&gt; Derivation
</code></pre>
<h3 id="arguments-3"><a class="header" href="#arguments-3">Arguments</a></h3>
<dl>
<dt id="module-1"><a class="header" href="#module-1">module</a></dt>
<dd>A nimi module attrset.</dd>
</dl>
<h2 id="niminimi.mkContainerImageWithConfig"><a class="header" href="#niminimi.mkContainerImageWithConfig"><code>nimi.mkContainerImageWithConfig</code></a></h2>
<p>Build a container image from an already-evaluated nimi config. This wires
the container entrypoint to the wrapper binary and uses
<code>nix2container.buildImage</code> when available (otherwise <code>dockerTools.buildImage</code>).</p>
<p>Use this when you already have an evaluated config (e.g., from <code>evalNimiModule</code>)
and want to avoid re-evaluating the module.</p>
<h3 id="example-4"><a class="header" href="#example-4">Example</a></h3>
<pre><code class="language-nix">let cfg = evalNimiModule { settings.binName = "my-nimi"; };
in mkContainerImageWithConfig cfg
</code></pre>
<h3 id="type-4"><a class="header" href="#type-4">Type</a></h3>
<pre><code>mkContainerImageWithConfig :: AttrSet -&gt; Derivation
</code></pre>
<h3 id="arguments-4"><a class="header" href="#arguments-4">Arguments</a></h3>
<dl>
<dt id="evaluatedconfig-2"><a class="header" href="#evaluatedconfig-2">evaluatedConfig</a></dt>
<dd>An already-evaluated nimi config (output of <code>evalNimiModule</code>).</dd>
</dl>
<h2 id="niminimi.mkContainerImage"><a class="header" href="#niminimi.mkContainerImage"><code>nimi.mkContainerImage</code></a></h2>
<p>Build a container image for a given nimi module. This evaluates the module,
wires the container entrypoint to the wrapper binary, and uses
<code>nix2container.buildImage</code> when available (otherwise <code>dockerTools.buildImage</code>).</p>
<p>This is a convenience wrapper around <code>mkContainerImageWithConfig</code> that handles
module evaluation for you.</p>
<h3 id="example-5"><a class="header" href="#example-5">Example</a></h3>
<pre><code class="language-nix">mkContainerImage { settings.binName = "my-nimi"; }
</code></pre>
<h3 id="type-5"><a class="header" href="#type-5">Type</a></h3>
<pre><code>mkContainerImage :: AttrSet -&gt; Derivation
</code></pre>
<h3 id="arguments-5"><a class="header" href="#arguments-5">Arguments</a></h3>
<dl>
<dt id="module-2"><a class="header" href="#module-2">module</a></dt>
<dd>A nimi module attrset.</dd>
</dl>
<h2 id="niminimi.mkBwrapWithConfig"><a class="header" href="#niminimi.mkBwrapWithConfig"><code>nimi.mkBwrapWithConfig</code></a></h2>
<p>Build a sandboxed wrapper using bubblewrap from an already-evaluated nimi config.
This creates a nimi binary and wraps it in a bubblewrap sandbox configured via
<code>settings.bubblewrap</code> options.</p>
<p>Use this when you already have an evaluated config (e.g., from <code>evalNimiModule</code>)
and want to avoid re-evaluating the module.</p>
<p>The sandbox is configured through the module system with sensible defaults:</p>
<ul>
<li><code>/nix/store</code> and <code>/sys</code> are read-only bound</li>
<li><code>/etc/resolv.conf</code> is bound with <code>--ro-bind-try</code> (skipped if missing)</li>
<li><code>/nix</code>, <code>/tmp</code>, <code>/run</code>, <code>/var</code>, <code>/etc</code> are tmpfs mounts</li>
<li><code>/dev</code> and <code>/proc</code> are bound</li>
<li>Network is shared but user/pid/uts/ipc/cgroup namespaces are unshared</li>
</ul>
<h3 id="example-6"><a class="header" href="#example-6">Example</a></h3>
<pre><code class="language-nix">let cfg = evalNimiModule {
  settings.binName = "my-sandboxed-app";
  settings.bubblewrap.unshare.pid = true;
};
in mkBwrapWithConfig cfg
</code></pre>
<h3 id="type-6"><a class="header" href="#type-6">Type</a></h3>
<pre><code>mkBwrapWithConfig :: AttrSet -&gt; Derivation
</code></pre>
<h3 id="arguments-6"><a class="header" href="#arguments-6">Arguments</a></h3>
<dl>
<dt id="evaluatedconfig-3"><a class="header" href="#evaluatedconfig-3">evaluatedConfig</a></dt>
<dd>An already-evaluated nimi config (output of <code>evalNimiModule</code>).</dd>
</dl>
<h2 id="niminimi.mkBwrap"><a class="header" href="#niminimi.mkBwrap"><code>nimi.mkBwrap</code></a></h2>
<p>Build a sandboxed wrapper using bubblewrap for a given nimi module.
This evaluates the module, creates a nimi binary, and wraps it in a
bubblewrap sandbox configured via <code>settings.bubblewrap</code> options.</p>
<p>This is a convenience wrapper around <code>mkBwrapWithConfig</code> that handles
module evaluation for you.</p>
<p>The sandbox is configured through the module system with sensible defaults:</p>
<ul>
<li><code>/nix/store</code> and <code>/sys</code> are read-only bound</li>
<li><code>/etc/resolv.conf</code> is bound with <code>--ro-bind-try</code> (skipped if missing)</li>
<li><code>/nix</code>, <code>/tmp</code>, <code>/run</code>, <code>/var</code>, <code>/etc</code> are tmpfs mounts</li>
<li><code>/dev</code> and <code>/proc</code> are bound</li>
<li>Network is shared but user/pid/uts/ipc/cgroup namespaces are unshared</li>
</ul>
<h3 id="example-7"><a class="header" href="#example-7">Example</a></h3>
<pre><code class="language-nix">mkBwrap {
  settings.binName = "my-sandboxed-app";
  settings.bubblewrap = {
    environment.MY_VAR = "value";
    roBinds = [
      { src = "/nix/store"; dest = "/nix/store"; }
      { src = "/data"; dest = "/data"; }
    ];
    tmpfs = [ "/tmp" "/run" ];
    chdir = "/app";
    unshare.pid = true;
  };
}
</code></pre>
<h3 id="type-7"><a class="header" href="#type-7">Type</a></h3>
<pre><code>mkBwrap :: AttrSet -&gt; Derivation
</code></pre>
<h3 id="arguments-7"><a class="header" href="#arguments-7">Arguments</a></h3>
<dl>
<dt id="module-3"><a class="header" href="#module-3">module</a></dt>
<dd>A nimi module attrset. Configure the sandbox via <code>settings.bubblewrap</code>.</dd>
</dl>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="options"><a href="#options" class="header">Options</a></h1>
<h2 id="_moduleargs"><a class="header" href="#_moduleargs">_module.args</a></h2>
<p>Additional arguments passed to each module in addition to ones
like <code>lib</code>, <code>config</code>,
and <code>pkgs</code>, <code>modulesPath</code>.</p>
<p>This option is also available to all submodules. Submodules do not
inherit args from their parent module, nor do they provide args to
their parent module or sibling submodules. The sole exception to
this is the argument <code>name</code> which is provided by
parent modules to a submodule and contains the attribute name
the submodule is bound to, or a unique generated name if it is
not bound to an attribute.</p>
<p>Some arguments are already passed by default, of which the
following <em>cannot</em> be changed with this option:</p>
<ul>
<li>
<p><code>lib</code>: The nixpkgs library.</p>
</li>
<li>
<p><code>config</code>: The results of all options after merging the values from all modules together.</p>
</li>
<li>
<p><code>options</code>: The options declared in all modules.</p>
</li>
<li>
<p><code>specialArgs</code>: The <code>specialArgs</code> argument passed to <code>evalModules</code>.</p>
</li>
<li>
<p>All attributes of <code>specialArgs</code></p>
<p>Whereas option values can generally depend on other option values
thanks to laziness, this does not apply to <code>imports</code>, which
must be computed statically before anything else.</p>
<p>For this reason, callers of the module system can provide <code>specialArgs</code>
which are available during import resolution.</p>
<p>For NixOS, <code>specialArgs</code> includes
<code>modulesPath</code>, which allows you to import
extra modules from the nixpkgs package tree without having to
somehow make the module aware of the location of the
<code>nixpkgs</code> or NixOS directories.</p>
<pre><code>{ modulesPath, ... }: {
  imports = [
    (modulesPath + "/profiles/minimal.nix")
  ];
}
</code></pre>
</li>
</ul>
<p>For NixOS, the default value for this option includes at least this argument:</p>
<ul>
<li><code>pkgs</code>: The nixpkgs package set according to
the <code>nixpkgs.pkgs</code> option.</li>
</ul>
<p><em>Type:</em>
lazy attribute set of raw value</p>
<p><em>Declared by:</em></p>
<ul>
<li><a href="https://github.com/NixOS/nixpkgs/blob//lib/modules.nix">&lt;nixpkgs/lib/modules.nix&gt;</a></li>
</ul>
<h2 id="assertionsassertion"><a class="header" href="#assertionsassertion">assertions.*.assertion</a></h2>
<p>Assertion to evaluate and check.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/assertions.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/assertions.nix</a></li>
</ul>
<h2 id="assertionsmessage"><a class="header" href="#assertionsmessage">assertions.*.message</a></h2>
<p>Message to print on assertion failure.</p>
<p><em>Type:</em>
string</p>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/assertions.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/assertions.nix</a></li>
</ul>
<h2 id="meta"><a class="header" href="#meta">meta</a></h2>
<p><a href="https://ryantm.github.io/nixpkgs/stdenv/meta/"><code>meta</code></a> attributes to
include in the output of generated <code>Nimi</code> packages</p>
<p><em>Type:</em>
lazy attribute set of raw value</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  meta = {
    description = "My cool nimi package";
  };
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/meta.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/meta.nix</a></li>
</ul>
<h2 id="passthru"><a class="header" href="#passthru">passthru</a></h2>
<p><a href="https://ryantm.github.io/nixpkgs/stdenv/stdenv/#var-stdenv-passthru"><code>passthru</code></a> attributes to
include in the output of generated <code>Nimi</code> packages</p>
<p><em>Type:</em>
lazy attribute set of raw value</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  passthru = {
    doXYZ = pkgs.writeShellApplication {
      name = "xyz-doer";
      text = ''
        xyz
      '';
    };
  };
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/passthru.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/passthru.nix</a></li>
</ul>
<h2 id="services"><a class="header" href="#services">services</a></h2>
<p>Services to run inside the nimi runtime.</p>
<p>Each attribute defines a named modular service: a reusable, composable
module that you can import, extend, and tailor for each instance. This
gives you clear service boundaries, easy reuse across projects, and
a consistent way to describe how each process should run.</p>
<p>The <code>services</code> option is an <code>lazyAttrsOf</code> submodule: the attribute name is
the service name, and the module content defines its behavior. You
typically provide a service by importing a module from a package and
then overriding or extending its options.</p>
<p>For the full upstream explanation and portability model, see the
<a href="https://nixos.org/manual/nixos/unstable/#modular-services">NixOS manual section on Modular Services</a>.</p>
<p><em>Type:</em>
lazy attribute set of (submodule)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  services."ghostunnel-plain-old" = {
    imports = [ pkgs.ghostunnel.services.default ];
    ghostunnel = {
      listen = "0.0.0.0:443";
      cert = "/root/service-cert.pem";
      key = "/root/service-key.pem";
      disableAuthentication = true;
      target = "backend:80";
      unsafeTarget = true;
    };
  };
  services."ghostunnel-client-cert" = {
    imports = [ pkgs.ghostunnel.services.default ];
    ghostunnel = {
      listen = "0.0.0.0:1443";
      cert = "/root/service-cert.pem";
      key = "/root/service-key.pem";
      cacert = "/root/ca.pem";
      target = "backend:80";
      allowCN = [ "client" ];
      unsafeTarget = true;
    };
  };
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi.nix</a></li>
</ul>
<h2 id="servicesnameconfigdata"><a class="header" href="#servicesnameconfigdata">services.&lt;name&gt;.configData</a></h2>
<p>Configuration data files for the service</p>
<p>These files are made available to the service and can be updated without restarting the service process, enabling configuration reloading.
The service manager implementation determines how these files are exposed to the service (e.g., via a specific directory path).
This path is available in the <code>path</code> sub-option for each <code>configData.&lt;name&gt;</code> entry.</p>
<p>This is particularly useful for services that support configuration reloading via signals (e.g., SIGHUP) or which pick up changes automatically, so that no downtime is required in order to reload the service.</p>
<p><em>Type:</em>
lazy attribute set of (submodule)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  "server.conf" = {
    text = ''
      port = 8080
      workers = 4
    '';
  };
  "ssl/cert.pem" = {
    source = ./cert.pem;
  };
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data.nix">/nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data.nix</a></li>
</ul>
<h2 id="servicesnameconfigdatanameenable"><a class="header" href="#servicesnameconfigdatanameenable">services.&lt;name&gt;.configData.&lt;name&gt;.enable</a></h2>
<p>Whether this configuration file should be generated.
This option allows specific configuration files to be disabled.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix">/nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix</a></li>
</ul>
<h2 id="servicesnameconfigdatanamename"><a class="header" href="#servicesnameconfigdatanamename">services.&lt;name&gt;.configData.&lt;name&gt;.name</a></h2>
<p>Name of the configuration file (relative to the service’s configuration directory). Defaults to the attribute name.</p>
<p><em>Type:</em>
string</p>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix">/nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix</a></li>
</ul>
<h2 id="servicesnameconfigdatanamepath"><a class="header" href="#servicesnameconfigdatanamepath">services.&lt;name&gt;.configData.&lt;name&gt;.path</a></h2>
<p>The actual path where this configuration file will be available.
This is determined by the service manager implementation.</p>
<p>On NixOS it is an absolute path.
Other service managers may provide a relative path, in order to be unprivileged and/or relocatable.</p>
<p><em>Type:</em>
string <em>(read only)</em></p>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix">/nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix</a></li>
</ul>
<h2 id="servicesnameconfigdatanamesource"><a class="header" href="#servicesnameconfigdatanamesource">services.&lt;name&gt;.configData.&lt;name&gt;.source</a></h2>
<p>Path of the source file.</p>
<p><em>Type:</em>
absolute path</p>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix">/nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix</a></li>
</ul>
<h2 id="servicesnameconfigdatanametext"><a class="header" href="#servicesnameconfigdatanametext">services.&lt;name&gt;.configData.&lt;name&gt;.text</a></h2>
<p>Text content of the configuration file.</p>
<p><em>Type:</em>
null or strings concatenated with “\n”</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">null
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix">/nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/config-data-item.nix</a></li>
</ul>
<h2 id="servicesnamemetamaintainers"><a class="header" href="#servicesnamemetamaintainers">services.&lt;name&gt;.meta.maintainers</a></h2>
<p>List of maintainers of each module.
This option should be defined at most once per module.</p>
<p>The option value is not a list of maintainers, but an attribute set that maps module file names to lists of maintainers.</p>
<p><em>Type:</em>
list of (maintainer)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">[ lib.maintainers.alice lib.maintainers.bob ]
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/modules/generic/meta-maintainers.nix">/nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/modules/generic/meta-maintainers.nix</a></li>
</ul>
<h2 id="servicesnameprocessargv"><a class="header" href="#servicesnameprocessargv">services.&lt;name&gt;.process.argv</a></h2>
<p>Command filename and arguments for starting this service.
This is a raw command-line that should not contain any shell escaping.
If expansion of environmental variables is required then use
a shell script or <code>importas</code> from <code>pkgs.execline</code>.</p>
<p><em>Type:</em>
list of (string or absolute path convertible to it)</p>
<p><em>Example:</em></p>
<pre><code class="language-nix">[ (lib.getExe config.package) "--nobackground" ]
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/service.nix">/nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/service.nix</a></li>
</ul>
<h2 id="servicesnameservices"><a class="header" href="#servicesnameservices">services.&lt;name&gt;.services</a></h2>
<p>A collection of <a href="https://nixos.org/manual/nixos/unstable/#modular-services">modular services</a> that are configured in one go.</p>
<p>You could consider the sub-service relationship to be an ownership relation.
It <strong>does not</strong> automatically create any other relationship between services (e.g. systemd slices), unless perhaps such a behavior is explicitly defined and enabled in another option.</p>
<p><em>Type:</em>
attribute set of (submodule)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/service.nix">/nix/store/cds46yhzs1aw2b65453w6n07xjf33mqh-12azrzlywd7jmsg1q9n4dpqqgb33p2wl-source/nixos/modules/system/service/portable/service.nix</a></li>
</ul>
<h2 id="settingsbinname"><a class="header" href="#settingsbinname">settings.binName</a></h2>
<p>Name of the binary to generate with your nimi wrapper.</p>
<p>Changes the name of the default generated binary name
from “nimi” to whatever you select.</p>
<p><em>Type:</em>
string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">"nimi"
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  settings.binName = "my-awesome-service-runner";
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bin-name.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bin-name.nix</a></li>
</ul>
<h2 id="settingsbubblewrap"><a class="header" href="#settingsbubblewrap">settings.bubblewrap</a></h2>
<p>Sandbox configuration for running nimi inside bubblewrap.</p>
<p>Use this to isolate the nimi process manager and its services from the
host system. Bubblewrap provides lightweight containerization through
Linux namespaces without requiring root privileges or a container runtime.</p>
<p>The defaults provide a minimal sandbox that can access the Nix store and
network while isolating the process namespace, filesystem writes, and
other system resources. Adjust these settings based on what your services
actually need.</p>
<p>Note that these options only take effect when using <code>nimi.mkBwrap</code> to
build your sandboxed binary.</p>
<p><em>Type:</em>
submodule</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  environment.APP_ENV = "production";
  chdir = "/app";
  roBinds = [
    { src = "/nix/store"; dest = "/nix/store"; }
    { src = "/etc/ssl"; dest = "/etc/ssl"; }
  ];
  extraTmpfs = [ "/app/cache" ];
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapappendflags"><a class="header" href="#settingsbubblewrapappendflags">settings.bubblewrap.appendFlags</a></h2>
<p>Extra flags appended after the generated bubblewrap arguments.</p>
<p>Use this for one-off bwrap options not covered by the module.
These appear at the end of the command line, just before <code>--</code>.</p>
<p><em>Type:</em>
list of string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">[ "--cap-add" "CAP_NET_BIND_SERVICE" ]

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapbinddev"><a class="header" href="#settingsbubblewrapbinddev">settings.bubblewrap.bind.dev</a></h2>
<p>Whether to enable bind /dev into the sandbox.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapbindproc"><a class="header" href="#settingsbubblewrapbindproc">settings.bubblewrap.bind.proc</a></h2>
<p>Whether to enable bind /proc into the sandbox.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapchdir"><a class="header" href="#settingsbubblewrapchdir">settings.bubblewrap.chdir</a></h2>
<p>Working directory to change to after entering the sandbox.</p>
<p>Set this to control where services start. When <code>null</code>, bubblewrap
does not change directory and the process inherits the caller’s
working directory (usually <code>/</code>).</p>
<p><em>Type:</em>
null or string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">null
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">"/app"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapdevbinds"><a class="header" href="#settingsbubblewrapdevbinds">settings.bubblewrap.devBinds</a></h2>
<p>Device bind mounts from the host into the sandbox.</p>
<p>Each entry maps a host path (<code>src</code>) to a path inside the sandbox
(<code>dest</code>). Unlike regular bind mounts, device bind mounts allow
access to device nodes, making them suitable for binding paths
like <code>/dev/dri</code> for GPU access or <code>/dev/snd</code> for audio.</p>
<p>The sandbox can access device files at these paths. Use this when
you need to expose specific device nodes to sandboxed processes.</p>
<p>For paths that may not exist on all systems, use <code>tryDevBinds</code>
instead.</p>
<p><em>Type:</em>
list of (submodule)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">[
  { src = "/dev/dri"; dest = "/dev/dri"; }
  { src = "/dev/snd"; dest = "/dev/snd"; }
]

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapdevbindsdest"><a class="header" href="#settingsbubblewrapdevbindsdest">settings.bubblewrap.devBinds.*.dest</a></h2>
<p>Path inside the sandbox where <code>src</code> appears.</p>
<p><em>Type:</em>
string</p>
<p><em>Example:</em></p>
<pre><code class="language-nix">"/etc/resolv.conf"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapdevbindssrc"><a class="header" href="#settingsbubblewrapdevbindssrc">settings.bubblewrap.devBinds.*.src</a></h2>
<p>Host path to bind into the sandbox.</p>
<p><em>Type:</em>
string</p>
<p><em>Example:</em></p>
<pre><code class="language-nix">"/etc/resolv.conf"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapdiewithparent"><a class="header" href="#settingsbubblewrapdiewithparent">settings.bubblewrap.dieWithParent</a></h2>
<p>Whether to enable terminate sandbox when parent process exits.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapenvironment"><a class="header" href="#settingsbubblewrapenvironment">settings.bubblewrap.environment</a></h2>
<p>Environment variables to set inside the sandbox.</p>
<p>These are passed to bubblewrap via <code>--setenv</code> and are available to
the nimi process manager and all services it spawns.</p>
<p><em>Type:</em>
lazy attribute set of string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  APP_ENV = "production";
  LOG_LEVEL = "info";
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapextratmpfs"><a class="header" href="#settingsbubblewrapextratmpfs">settings.bubblewrap.extraTmpfs</a></h2>
<p>Additional tmpfs mounts appended to the default list.</p>
<p>Use this to add writable scratch directories without replacing
the standard set. For complete control, override <code>tmpfs</code> directly.</p>
<p><em>Type:</em>
list of string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">[ "/app/cache" "/app/tmp" ]

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapflags"><a class="header" href="#settingsbubblewrapflags">settings.bubblewrap.flags</a></h2>
<p>Final list of flags passed to the <code>bwrap</code> executable.</p>
<p>This is computed automatically from the other options in this
module. You can read it to inspect the generated command line, but
setting it directly replaces the generated flags entirely and may
break the sandbox. Prefer <code>prependFlags</code> or <code>appendFlags</code> to inject
custom arguments.</p>
<p><em>Type:</em>
list of string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapgid"><a class="header" href="#settingsbubblewrapgid">settings.bubblewrap.gid</a></h2>
<p>Use a custom group id in the sandbox.</p>
<p>Only applies if <code>unshare.user</code> is <code>true</code>.</p>
<p><em>Type:</em>
null or 32 bit unsigned integer; between 0 and 4294967295 (both inclusive)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">null
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">1000
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraphostname"><a class="header" href="#settingsbubblewraphostname">settings.bubblewrap.hostname</a></h2>
<p>Use a custom hostname in the sandbox.</p>
<p>Only applies if <code>unshare.uts</code> is <code>true</code>.</p>
<p><em>Type:</em>
null or string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">null
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">nixos
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapprependflags"><a class="header" href="#settingsbubblewrapprependflags">settings.bubblewrap.prependFlags</a></h2>
<p>Extra flags inserted before the generated bubblewrap arguments.</p>
<p>Use this when argument order matters, for example to set options
that must appear early in the bwrap invocation.</p>
<p><em>Type:</em>
list of string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">[ "--clearenv" ]

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraprobinds"><a class="header" href="#settingsbubblewraprobinds">settings.bubblewrap.roBinds</a></h2>
<p>Read-only bind mounts from the host into the sandbox.</p>
<p>Each entry maps a host path (<code>src</code>) to a path inside the sandbox
(<code>dest</code>). The sandbox can read these paths but not modify them.</p>
<p>The default includes <code>/nix/store</code> (required for Nix binaries) and
<code>/sys</code> (for system information). Override this list carefully;
omitting <code>/nix/store</code> will break most Nix-built programs.</p>
<p>For paths that may not exist on all systems, use <code>tryRoBinds</code>
instead.</p>
<p><em>Type:</em>
list of (submodule)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[
  {
    dest = "/nix/store";
    src = "/nix/store";
  }
  {
    dest = "/sys";
    src = "/sys";
  }
]
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">[
  { src = "/nix/store"; dest = "/nix/store"; }
  { src = "/etc/ssl"; dest = "/etc/ssl"; }
  { src = "/run/secrets"; dest = "/secrets"; }
]

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraprobindsdest"><a class="header" href="#settingsbubblewraprobindsdest">settings.bubblewrap.roBinds.*.dest</a></h2>
<p>Path inside the sandbox where <code>src</code> appears.</p>
<p><em>Type:</em>
string</p>
<p><em>Example:</em></p>
<pre><code class="language-nix">"/etc/resolv.conf"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraprobindssrc"><a class="header" href="#settingsbubblewraprobindssrc">settings.bubblewrap.roBinds.*.src</a></h2>
<p>Host path to bind into the sandbox.</p>
<p><em>Type:</em>
string</p>
<p><em>Example:</em></p>
<pre><code class="language-nix">"/etc/resolv.conf"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraptmpfs"><a class="header" href="#settingsbubblewraptmpfs">settings.bubblewrap.tmpfs</a></h2>
<p>Paths to mount as temporary filesystems inside the sandbox.</p>
<p>These mounts are writable but ephemeral; contents are lost when the
sandbox exits. They also hide any host content at the same path.</p>
<p>The default list creates writable areas for common system paths
while keeping the sandbox isolated. The <code>/nix</code> tmpfs is mounted
first, then <code>/nix/store</code> is bind-mounted on top, allowing writes
elsewhere under <code>/nix</code> (like <code>/nix/var</code>) without touching the
real store.</p>
<p><em>Type:</em>
list of string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[
  "/nix"
  "/tmp"
  "/run"
  "/var"
  "/etc"
]
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">[ "/tmp" "/run" ]

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraptrydevbinds"><a class="header" href="#settingsbubblewraptrydevbinds">settings.bubblewrap.tryDevBinds</a></h2>
<p>Device bind mounts that are skipped if the source does not exist.</p>
<p>Like <code>devBinds</code>, but uses <code>--dev-bind-try</code> which silently skips
the mount if the host path does not exist. Use this for device
paths that may not be present on all systems, such as GPU or
audio devices.</p>
<p><em>Type:</em>
list of (submodule)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">[
  { src = "/dev/dri"; dest = "/dev/dri"; }
  { src = "/dev/nvidia0"; dest = "/dev/nvidia0"; }
]

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraptrydevbindsdest"><a class="header" href="#settingsbubblewraptrydevbindsdest">settings.bubblewrap.tryDevBinds.*.dest</a></h2>
<p>Path inside the sandbox where <code>src</code> appears.</p>
<p><em>Type:</em>
string</p>
<p><em>Example:</em></p>
<pre><code class="language-nix">"/etc/resolv.conf"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraptrydevbindssrc"><a class="header" href="#settingsbubblewraptrydevbindssrc">settings.bubblewrap.tryDevBinds.*.src</a></h2>
<p>Host path to bind into the sandbox.</p>
<p><em>Type:</em>
string</p>
<p><em>Example:</em></p>
<pre><code class="language-nix">"/etc/resolv.conf"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraptryrobinds"><a class="header" href="#settingsbubblewraptryrobinds">settings.bubblewrap.tryRoBinds</a></h2>
<p>Read-only bind mounts that are skipped if the source does not exist.</p>
<p>Like <code>roBinds</code>, but uses <code>--ro-bind-try</code> which silently skips the
mount if the host path does not exist. Use this for paths that may
not be present on all systems.</p>
<p>The default includes <code>/etc/resolv.conf</code> for DNS resolution, which
may not exist on systems using systemd-resolved or other DNS
configurations.</p>
<p><em>Type:</em>
list of (submodule)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[
  {
    dest = "/etc/resolv.conf";
    src = "/etc/resolv.conf";
  }
]
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">[
  { src = "/etc/resolv.conf"; dest = "/etc/resolv.conf"; }
  { src = "/etc/hosts"; dest = "/etc/hosts"; }
]

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraptryrobindsdest"><a class="header" href="#settingsbubblewraptryrobindsdest">settings.bubblewrap.tryRoBinds.*.dest</a></h2>
<p>Path inside the sandbox where <code>src</code> appears.</p>
<p><em>Type:</em>
string</p>
<p><em>Example:</em></p>
<pre><code class="language-nix">"/etc/resolv.conf"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewraptryrobindssrc"><a class="header" href="#settingsbubblewraptryrobindssrc">settings.bubblewrap.tryRoBinds.*.src</a></h2>
<p>Host path to bind into the sandbox.</p>
<p><em>Type:</em>
string</p>
<p><em>Example:</em></p>
<pre><code class="language-nix">"/etc/resolv.conf"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapuid"><a class="header" href="#settingsbubblewrapuid">settings.bubblewrap.uid</a></h2>
<p>Use a custom user id in the sandbox.</p>
<p>Only applies if <code>unshare.user</code> is <code>true</code>.</p>
<p><em>Type:</em>
null or 32 bit unsigned integer; between 0 and 4294967295 (both inclusive)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">null
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">1000
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapunsharecgroup"><a class="header" href="#settingsbubblewrapunsharecgroup">settings.bubblewrap.unshare.cgroup</a></h2>
<p>Whether to enable create a new cgroup namespace.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapunshareipc"><a class="header" href="#settingsbubblewrapunshareipc">settings.bubblewrap.unshare.ipc</a></h2>
<p>Whether to enable create a new IPC namespace.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapunsharepid"><a class="header" href="#settingsbubblewrapunsharepid">settings.bubblewrap.unshare.pid</a></h2>
<p>Whether to enable create a new PID namespace.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapunshareuser"><a class="header" href="#settingsbubblewrapunshareuser">settings.bubblewrap.unshare.user</a></h2>
<p>Whether to enable create a new user namespace.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingsbubblewrapunshareuts"><a class="header" href="#settingsbubblewrapunshareuts">settings.bubblewrap.unshare.uts</a></h2>
<p>Whether to enable create a new UTS (hostname) namespace.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/bubblewrap.nix</a></li>
</ul>
<h2 id="settingscontainer"><a class="header" href="#settingscontainer">settings.container</a></h2>
<p>Configures nimi’s builtin container generation.</p>
<p>Note that none of these options will have any effect unless you are using
<code>nimi.mkContainerImage</code> to build your containers.</p>
<p>These are mappings to <a href="https://github.com/nlewo/nix2container?tab=readme-ov-file#nix2containerbuildimage"><code>nix2container</code>’s <code>buildImage</code></a> function, please
check there for further documentation.</p>
<p><em>Type:</em>
submodule</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingscontainercopytoroot"><a class="header" href="#settingscontainercopytoroot">settings.container.copyToRoot</a></h2>
<p>A derivation (or list of derivations) copied in the image root directory
(store path prefixes <code>/nix/store/hash-path</code> are removed,
in order to relocate them at the image <code>/</code>).</p>
<p><code>pkgs.buildEnv</code> can be used to build a derivation which has to
be copied to the image root. For instance, to get bash and
coreutils in the image <code>/bin</code>:</p>
<p><em>Type:</em>
(list of path in the Nix store) or path in the Nix store convertible to it</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingscontainerfromimage"><a class="header" href="#settingscontainerfromimage">settings.container.fromImage</a></h2>
<p>An image that is used as base image of this image;</p>
<p>Use <code>nix2container.pullImage</code> or <code>nix2container.pullImageFromManifest</code> to supply this.</p>
<p><em>Type:</em>
null or path in the Nix store</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">null
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingscontainerimageconfig"><a class="header" href="#settingscontainerimageconfig">settings.container.imageConfig</a></h2>
<p>An attribute set describing an image configuration as defined in the <a href="https://github.com/opencontainers/image-spec/blob/8b9d41f48198a7d6d0a5c1a12dc2d1f7f47fc97f/specs-go/v1/config.go#L23">OCI image specification</a>.</p>
<p><em>Type:</em>
open submodule of lazy attribute set of anything</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{
  WorkingDir = {
    _type = "override";
    content = "/root";
    priority = 1000;
  };
}
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingscontainerinitializenixdatabase"><a class="header" href="#settingscontainerinitializenixdatabase">settings.container.initializeNixDatabase</a></h2>
<p>To initialize the Nix database with all store paths added into the image.</p>
<p>Note this is only useful to run nix commands from the image,
for instance to build an image used by a CI to run Nix builds.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">false
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingscontainerlayers"><a class="header" href="#settingscontainerlayers">settings.container.layers</a></h2>
<p>A list of layers built with the <code>nix2container.buildLayer</code> function.</p>
<p>If a store path in deps or contents belongs to one of these layers, this store path is skipped.</p>
<p>This is pretty useful to isolate store paths that are often updated from more stable store paths,
to speed up build and push time.</p>
<p><em>Type:</em>
list of path in the Nix store</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingscontainermaxlayers"><a class="header" href="#settingscontainermaxlayers">settings.container.maxLayers</a></h2>
<p>The maximum number of layers to create.</p>
<p>This is based on the store path “popularity” as described in <a href="https://grahamc.com/blog/nix-and-layered-docker-images/">this blog post</a>.</p>
<p>Note this is applied on the image layers and not on layers added with the <code>buildImage.layers</code> attribute.</p>
<p><em>Type:</em>
positive integer, meaning &gt;0</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">1
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingscontainername"><a class="header" href="#settingscontainername">settings.container.name</a></h2>
<p>The name of the generated image</p>
<p><em>Type:</em>
string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">"nimi-container"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingscontainerperms"><a class="header" href="#settingscontainerperms">settings.container.perms</a></h2>
<p>A list of file permisssions which are set when the tar layer is created: these permissions are not written to the Nix store.</p>
<p><em>Type:</em>
list of (submodule)</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">[ ]
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingscontainertag"><a class="header" href="#settingscontainertag">settings.container.tag</a></h2>
<p>The tag for the generated image to use</p>
<p><em>Type:</em>
string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">"latest"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/container.nix</a></li>
</ul>
<h2 id="settingslogging"><a class="header" href="#settingslogging">settings.logging</a></h2>
<p>Logging behavior for the nimi process manager.</p>
<p>This section controls if per-service log files are written during a run.
When enabled, each service writes to its own file under the configured
logs directory.</p>
<p>Log files are created at runtime and live in a run-specific subdirectory
under <code>logsDir</code> (for example <code>logs-0/service-a.txt</code>). Each line from the
service stdout or stderr is appended to the same file, preserving
execution order as best as possible.</p>
<p><em>Type:</em>
submodule</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  enable = true;
  logsDir = "my_logs";
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/logging.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/logging.nix</a></li>
</ul>
<h2 id="settingsloggingenable"><a class="header" href="#settingsloggingenable">settings.logging.enable</a></h2>
<p>Whether to enable If per-service log files should be written to <code>settings.logging.logsDir</code>.</p>
<p>When disabled, log output still streams to stdout/stderr but no files
are created.
.</p>
<p><em>Type:</em>
boolean</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">false
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">true
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/logging.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/logging.nix</a></li>
</ul>
<h2 id="settingslogginglogsdir"><a class="header" href="#settingslogginglogsdir">settings.logging.logsDir</a></h2>
<p>Directory to create and write per-service logs to.</p>
<p>Nimi creates a <code>logs-&lt;n&gt;</code> subdirectory inside this path at runtime
and writes one file per service.</p>
<p><em>Type:</em>
string</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">"nimi_logs"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/logging.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/logging.nix</a></li>
</ul>
<h2 id="settingsrestart"><a class="header" href="#settingsrestart">settings.restart</a></h2>
<p>Restart policy for the nimi process manager.</p>
<p>Use this to control if and how services are restarted after they exit.
This is the main safety net for keeping long-running services alive, and
also a guardrail to prevent tight restart loops from burning CPU.</p>
<p>You can choose a policy that matches the reliability needs of each
deployment. For development you might disable restarts entirely, while
production workloads usually benefit from a bounded or always-on policy.</p>
<p><em>Type:</em>
submodule</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  mode = "up-to-count";
  time = 500;
  count = 3;
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/restart.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/restart.nix</a></li>
</ul>
<h2 id="settingsrestartcount"><a class="header" href="#settingsrestartcount">settings.restart.count</a></h2>
<p>Maximum number of restart attempts when <code>mode</code> is <code>up-to-count</code>.</p>
<p>Once this limit is reached, the service is left stopped until you
intervene or change the configuration.</p>
<p><em>Type:</em>
positive integer, meaning &gt;0</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">5
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">3
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/restart.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/restart.nix</a></li>
</ul>
<h2 id="settingsrestartmode"><a class="header" href="#settingsrestartmode">settings.restart.mode</a></h2>
<p>Selects the restart behavior.</p>
<ul>
<li><code>never</code>: do not restart failed services.</li>
<li><code>up-to-count</code>: restart up to <code>count</code> times, then stop.</li>
<li><code>always</code>: always restart on failure.</li>
</ul>
<p>Choose <code>up-to-count</code> if you want a service to get a few retries
during a transient failure, but still fail fast when the issue is
persistent. Choose <code>always</code> when continuous availability matters
more than surfacing the failure.</p>
<p><em>Type:</em>
one of “never”, “up-to-count”, “always”</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">"always"
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">"up-to-count"
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/restart.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/restart.nix</a></li>
</ul>
<h2 id="settingsrestarttime"><a class="header" href="#settingsrestarttime">settings.restart.time</a></h2>
<p>Delay between restarts in milliseconds.</p>
<p>Increase this value for crash loops to give the system time to
recover resources or for dependent services to come back.</p>
<p><em>Type:</em>
positive integer, meaning &gt;0</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">1000
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">250
</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/restart.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/restart.nix</a></li>
</ul>
<h2 id="settingsstartup"><a class="header" href="#settingsstartup">settings.startup</a></h2>
<p>Startup behavior for the nimi process manager.</p>
<p>This section lets you run a one-time initialization command before any
configured services are started. It is useful for bootstrapping state,
preparing directories, or running a short setup task that should happen
once per process manager start.</p>
<p>The command is executed once and then the normal service startup proceeds.
If you do not need a startup hook, leave it unset.</p>
<p><em>Type:</em>
submodule</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">{ }
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">{
  runOnStartup = /nix/store/abcd1234-my-init/bin/my-init;
}

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/startup.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/startup.nix</a></li>
</ul>
<h2 id="settingsstartuprunonstartup"><a class="header" href="#settingsstartuprunonstartup">settings.startup.runOnStartup</a></h2>
<p>Path to a binary to run once at startup.</p>
<p>This should be a single executable in the Nix store, not a shell
snippet. Use <code>lib.getExe</code> to turn a package or derivation into a
runnable path.</p>
<p>The command runs before services start, so it is a good place to
create files, check preconditions, or populate caches. If you need
a long-running process, configure it as a service instead.</p>
<p>Set to <code>null</code> to disable.</p>
<p><em>Type:</em>
null or path in the Nix store</p>
<p><em>Default:</em></p>
<pre><code class="language-nix">null
</code></pre>
<p><em>Example:</em></p>
<pre><code class="language-nix">lib.getExe (
  pkgs.writeShellApplication {
    name = "example-startup-script";
    text = ''
      echo "hello world"
    '';
  }
)

</code></pre>
<p><em>Declared by:</em></p>
<ul>
<li><a href="file:///nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/startup.nix">/nix/store/lwmfqvsl2frf336jhwhwfxl3g99p8wb7-source/nix/modules/nimi/startup.nix</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
